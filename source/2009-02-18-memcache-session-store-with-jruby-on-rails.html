---
layout: post
title: MemCache Session Store with JRuby on Rails
published: true
---
<p><strong>The JRuby MemCache Client Plugin has been replaced by the JRuby MemCache Client Gem. Details can be found at <a href="http://fredjean.net/2009/05/06/jruby-memcache-client-gem/jruby-memcache-client-gem">JRuby MemCache Client Gem</a></strong></p><p>We realized a few weeks ago that we spent a fair amount of time writing <a href="http://kenai.com/" title="Project Kenai">Project Kenai</a>'s sessions to our database. We already had decided to start using fragment caching and we were exploring different options on the client side.</p><p>Project Kenai's front end is a Ruby on Rails web application that is deployed to Glassfish and running under JRuby. We do have multiple JRuby runtimes per domain. There <a href="http://www.nabble.com/Re:-jruby-memcache-client-project-started-on-GitHub-p21138280.html">are issues with running the Ruby MemCache client with a JRuby on Rails</a> application, so we paid some attention to <a href="http://www.linkedin.com/in/ikailan">Ikai Lan</a>'s <a href="http://github.com/ikai/jruby-memcache-client/tree/master">jruby-memcache-client library</a>. It is a wrapper around a Java based MemCache client that support connection pooling back to the memcached servers.</p><p>I quickly discovered that Ikai had focused on the Rails cache store but hadn't put work on the session store. I forked his project and started adding support for a session store.</p><h3>Using the jruby_memcache_client plugin</h3><p>Here are the steps to install the client:</p><ol>
<li>Run "script/plugin install git://github.com/fredjean/jruby_memcache_client.git" in the root of your Rails application. This will install my forked copy of the plugin.</li>
<li>Configure the MemCache client by following the instructions located at <a href="http://wiki.rubyonrails.org/rails/pages/HowtoChangeSessionStore">http://wiki.rubyonrails.org/rails/pages/HowtoChangeSessionStor</a>e .</li>
<li>Finally, change the config.action_controller.session_store to use :j_mem_cache_store instead of :mem_cache_store</li>
</ol><p>Make sure that you have a memcached server running and start your rails application.</p><h3>Making sure that it is running</h3>You can verify that the sessions are sent to the MemCache store by restaring memcache with a more verbose setting. You should then be able to see sessions being put into and retrieved from the session store.<div class="blogger-post-footer"><img class="posterous_download_image" src="https://blogger.googleusercontent.com/tracker/2472972155627143715-2052449541074071293?l=blog.fredjean.net" height="1" alt="" width="1" /></div>
